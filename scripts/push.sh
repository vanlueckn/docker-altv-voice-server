#!/bin/bash

BRANCH=$1
BUILD=$2

echo "build image"
docker build . --build-arg BRANCH=$BRANCH -t $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BUILD
docker tag $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BUILD $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BRANCH
docker tag $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BUILD $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BRANCH-$BUILD

# push it!

echo "push base image"
docker push $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BUILD
docker push $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BRANCH
docker push $REGISTRY/$REGISTRY_ALIAS/$REPOSITORY:$BRANCH-$BUILD